@model PROG7312_POE_PART1.Models.ReportIssue

@{
    ViewData["Title"] = "ReportIssues";
}

<!DOCTYPE html>
<html>
<head>
    <title>Report Issues</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/html/site.css">
    
    <!-- Google Maps Places API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDcxBD9JkNLa8DFBSZx-QQ5u-LLclpsh_E&libraries=places" type="text/javascript"></script>
</head>
<style>

    .btn-report{
        background-color: orange;
        color: white;
        padding: 8px 16px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 500;
        border: 2px solid orange;
        display:inline-block;
    }/*(W3Schools,2025)*/

    .btn-report:hover{
        background-color: transparent;
        color: orange;
        border: 2px solid orange;
        text-decoration: none;
    }/*(W3Schools,2025)*/

    .btn-back{
        background-color: grey;
        color: white;
        padding: 8px 16px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 500;
        border: 2px solid grey;
        display:inline-block;
    }/*(W3Schools,2025)*/

    .btn-back:hover{
        background-color: transparent;
        color: grey;
        border: 2px solid grey;
        text-decoration: none;
    }/*(W3Schools,2025)*/

    /* Dropdown styling */
    .dropbtn {
        background-color: white;
        color: grey;
        padding: 0.375rem 0.75rem;
        font-size: 1rem;
        border: 1px solid #ced4da;
        border-radius: 0.375rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        height: 38px;
    }/*(W3Schools,2025)*/

    .dropdown {
        position: relative;
        display: block;
        width: 100%;
        margin-top: 0.5rem;
    }/*(W3Schools,2025)*/

    .dropdown-content a {
        color: grey;
        padding: 10px 12px;
        text-decoration: none;
        display: block;
        width: 100%;
        box-sizing: border-box;
    }/*(W3Schools,2025)*/

    .dropdown-content {
        display: none;
        position: absolute;
        background-color: white;
        width: 100%;
        overflow: auto;
        box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
        z-index: 1;
        border-radius: 0.375rem;
        border: 1px solid #198754;
        top: 100%;
        left: 0;
    }/*(W3Schools,2025)*/

    /*Styling the form*/
    .form-control:focus {
        border-color: orange;
        box-shadow: 0 0 0 0.25rem orange;
    }/*(W3Schools,2025)*/

    .form-input-group {
        display: block;
        max-width: 700px;
        gap: 10px;
        margin: 10px auto;
    }/*(W3Schools,2025)*/

    .form-input-group label{
        display: block;
        margin-bottom: 5px;
    }/*(W3Schools,2025)*/

    .form-input-group input[type="file"], .form-input-group select, .form-input-group textarea, .form-control{
       width: 100%;
       box-sizing: border-box;
       margin-bottom: 15px;
    }/*(W3Schools,2025)*/

    .form-group{
        display: flex;
        justify-content: center;
        gap: 10px;
        max-width: 700px;
        margin: 0 auto;
    }/*(W3Schools,2025)*/

    .btn-back, .btn-report{
        flex:1;
        text-align: center;
        box-sizing: border-box;
    }/*(W3Schools,2025)*/
    
    /*Dropdown styling */
    .dropbtn {
        background-color: white;
        color: #333;
        padding: 0.375rem 0.75rem;
        font-size: 1rem;
        border: 1px solid #ced4da;
        border-radius: 0.375rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        height: 38px;
    }/*(W3Schools,2025)*/

    .dropdown {
        position: relative;
        display: block;
        width: 100%;
        margin-top: 0.5rem;
    }/*(W3Schools,2025)*/

    .dropdown-content a {
        color: #333;
        padding: 10px 12px;
        text-decoration: none;
        display: block;
        width: 100%;
        box-sizing: border-box;
    }/*(W3Schools,2025)*/

    .dropdown-content {
        display: none;
        position: absolute;
        background-color: white;
        width: 100%;
        overflow: auto;
        box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
        z-index: 1;
        border-radius: 0.375rem;
        border: 1px solid orange;
        top: 100%;
        left: 0;
    }/*(W3Schools,2025)*/

    .dropdown-content a:hover {
        background-color: orange;
        color: white;
    } /*(W3Schools,2025)*/

    .dropdown:hover .dropbtn {
        background-color: orange;
    }/*(W3Schools,2025)*/

    .show {
        display: block;
    }/*(W3Schools,2025)*/

    /*Progress bar*/
    .progress-container {
        width: 100%;
        background-color: #f3f3f3;
        border-radius: 20px;
        height: 20px;
        overflow: hidden;
        border: 1px solid #ddd;
    }/*(W3Schools,2025)*/

    .progress-bar {
        height: 100%;
        width: 0%;
        background-color: orange;
        text-align: center;
        line-height: 20px;
        color: white;
        font-size: 14px;
        font-weight: bold;
        border-radius: 20px 0 0 20px;
        transition: width 0.3s ease-in-out;
    }/*(W3Schools,2025)*/
</style>
<body>

    <br />

    <!--Heading-->
    <h1 style="text-align: center">Report Any Issues</h1>

    <hr />

    <br />

    <!-- Progress Bar -->
    <div class="progress-container" style="max-width:700px; margin:20px auto;">
        <div id="progressBar" class="progress-bar"></div>
    </div>

    <br />

    <!--Form to report any issues-->
    <div class="container mt-3">
        <form asp-action="ReportIssues" enctype="multipart/form-data" method="post">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <!--errpr message informaing the user they have not filled in all the required fields ((Dimitrov,2023))-->
            @if (ViewBag.Status != null)
            {
                @if (ViewBag.Message != null)
                {
                    <div class="alert @(ViewBag.Status == "Success" ? "alert-success" : "alert-danger") alert-dismissible fade show" role="alert">
                        <b>@(ViewBag.Status == "Success" ? "Success!" : "Error!")</b> @ViewBag.Message
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div><!--(W3School,2025)-->
                }
            }
            <div class="form-input-group mb-3 mt-3">
                <label asp-for="Location" class="control-label fw-bold">Location:</label>
                <input asp-for="Location" class="form-control" />
                <span asp-validation-for="Location" class="text-danger"></span>
            </div><!--(Lopez,2023)-->
            <div class="form-input-group mb-3 mt-3">
                <label asp-for="Category" class="control-label fw-bold">Category:</label>
                <select asp-for="Category" class="form-control" asp-items="(SelectList)ViewBag.Categories">
                    <option value="">-- Select Category --</option>
                </select>
                <span asp-validation-for="Category" class="text-danger"></span>
            </div>
            <div class="form-input-group mb-3 mt-3">
                <label asp-for="Description" class="control-label fw-bold">Description:</label>
                <textarea asp-for="Description" class="form-control"></textarea>
                <span asp-validation-for="Description" class="text-danger"></span>
            </div>
            <!--Adding a media file which allows jpg, jpeg, png, pdf, doc and docx-->
            <div class="form-input-group mb-3 mt-3">
                <label class="control-label fw-bold">Media Attachment:</label>
                <input type="file" name="mediaFile" class="form-control"
                       accept=".jpg,.jpeg,.png,.pdf,.doc,.docx" />
                @Html.ValidationMessage("MediaFile", null, new { @class = "text-danger" })
            </div>
            <br>
            <div class="form-group">
                <input type="submit" value="Create" class="btn-report" />
                <a asp-controller="Home" asp-action="Index" class="btn-back">Back</a>
            </div>

            <br />
        </form>
    </div>

    <!--Logic for the selection of the selection of a location and error message if the location was not valid (Code2Night,2021)-->
    <script>
        function initAutocomplete() {
            const input = document.getElementById('Location');
            const autocomplete = new google.maps.places.Autocomplete(input);

            autocomplete.addListener('place_changed', function () {
                const place = autocomplete.getPlace();

                if (!place.geometry) {
                    alert("No details available for input: '" + place.name + "'");
                    return;
                }

                const address = place.formatted_address;
                const latitude = place.geometry.location.lat();
                const longitude = place.geometry.location.lng();
            });
        }

        google.maps.event.addDomListener(window, 'load', initAutocomplete);
        
        //Progress bar
        const fields = [
            document.querySelector('[name="Location"]'),
            document.querySelector('[name="Category"]'),
            document.querySelector('[name="Description"]'),
            document.querySelector('[name="mediaFile"]')
        ];

        function updateProgressBar() {
            let filled = 0;

            fields.forEach(field => {
                if (field.type === "file") {
                    if (field.files.length > 0) filled++;
                } else if (field.value.trim() !== "") {
                    filled++;
                }
            });

            let percent = (filled / fields.length) * 100;
            const progressBar = document.getElementById("progressBar");
            progressBar.style.width = percent + "%";
            progressBar.textContent = Math.round(percent) + "%";
        }

        fields.forEach(field => {
            field.addEventListener("input", updateProgressBar);
            field.addEventListener("change", updateProgressBar);
        });

        // Recalculate progress immediately after page reload
        window.addEventListener("DOMContentLoaded", updateProgressBar);

    </script>
</body>
</html>
